<!DOCTYPE html>
<html lang="ht">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <title>Adam_D'H7</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Adam_D'H7" />
  <link rel="apple-touch-icon" href="https://res.cloudinary.com/dckwrqrur/image/upload/v1757205404/tf-stream-url/Screenshot_20250906_202106_Chrome_go9vhu.png" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --bg: #000;
      --muted: #9aa0a6;
      --accent: #fff;
      --seek-height: 8px;
      --box-bg: rgba(255,255,255,0.02);
      --box-border: rgba(255,255,255,0.03);
      --card-max-width: 920px;
      --card-min-height: 80px;
      --card-max-height: 80vh;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--bg); color: #fff; font-family: 'Roboto', sans-serif; -webkit-font-smoothing: antialiased; }
    body { padding-bottom: 60px; }

    .header {
      padding: 18px 16px;
      text-align: center;
      position: sticky;
      top: 0;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,0.7);
      z-index: 10;
    }
    .logo {
      font-size: 26px;
      font-weight: 700;
      background: linear-gradient(90deg,#fff,#000);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .search-container { display: flex; justify-content: center; padding: 8px 20px; }
    .search-box {
      width: 100%;
      max-width: 500px;
      background: #1c1c1e;
      border: none;
      padding: 10px 14px;
      border-radius: 12px;
      color: #fff;
      font-size: 15px;
      outline: none;
    }

    #explorerView {
      padding: 18px;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      background: #000;
      -webkit-overflow-scrolling: touch;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    #explorerView::-webkit-scrollbar { display: none; }

    .post-card {
      background: #111;
      border-radius: 14px;
      padding: 14px;
      margin-bottom: 18px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.7);
    }
    .post-name {
      font-weight: 700;
      font-size: 16px;
      margin: 8px 0;
      color: #fff;
    }
    .post-text {
      font-size: 14px;
      color: #ddd;
      margin-bottom: 10px;
      white-space: pre-wrap;
    }
    .post-desc {
      font-size: 13px;
      color: #ccc;
      margin-top: 8px;
    }
    .media-wrap { text-align: center; margin: 0 0 10px 0; }
    .post-thumb-container {
      position: relative;
      display: inline-block;
      max-width: var(--card-max-width);
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: inset 0 0 18px rgba(0,0,0,0.45), 0 6px 18px rgba(0,0,0,0.6);
      min-height: var(--card-min-height);
      max-height: var(--card-max-height);
    }
    .post-thumb, .post-thumb img, .post-thumb video, .post-thumb iframe {
      display: block;
      width: auto;
      max-width: 100%;
      height: auto;
      max-height: var(--card-max-height);
      object-fit: contain;
      background: #000;
    }
    .post-thumb iframe, .post-thumb video { width: 100%; }

    .social-section {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #333;
      display: flex;
      justify-content: center;
      gap: 18px;
      flex-wrap: wrap;
    }
    .social-section a {
      color: #fff;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: rgba(255,255,255,0.03);
    }
    .social-section i { font-size: 18px; }

    .video-card {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
      aspect-ratio: 16/9;
      max-height: 68vh;
      min-height: 180px;
      touch-action: none;
    }
    video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
      background: #000;
      transition: filter .08s linear;
    }
    video.contain { object-fit: contain; }

    .controls-wrap {
      position: absolute;
      left: 12px;
      right: 12px;
      bottom: 12px;
      pointer-events: none;
      z-index: 12;
      transition: opacity .18s ease;
    }
    .time-row {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      color: var(--muted);
      font-size: 14px;
      justify-content: center;
    }
    .time { width: 82px; text-align: center; font-variant-numeric: tabular-nums; }
    .progress { flex: 1; max-width: 820px; display: flex; align-items: center; }
    .seek {
      position: relative;
      height: var(--seek-height);
      width: 100%;
      border-radius: 999px;
      cursor: pointer;
      background: repeating-linear-gradient(90deg, rgba(255,255,255,0.06) 0 2px, transparent 2px 12px);
    }
    .fill {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,255,255,0.55));
    }
    .thumb {
      position: absolute;
      top: 50%;
      transform: translate(-50%,-50%);
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #0b0b0b;
      border: 2px solid var(--accent);
      pointer-events: auto;
      touch-action: none;
    }

    .controls-hidden { opacity: 0; pointer-events: none; }
    .controls-visible { opacity: 1; pointer-events: auto; }

    .inside-mini-controls {
      position: absolute;
      left: 12px;
      right: 12px;
      bottom: 92px;
      z-index: 13;
      display: flex;
      justify-content: center;
      gap: 14px;
      pointer-events: auto;
      transition: bottom .18s ease, opacity .18s ease;
    }
    .inside-hidden { opacity: 0; pointer-events: none; }
    .inside-visible { opacity: 1; pointer-events: auto; }
    .video-card.landscape-mode .inside-mini-controls { bottom: 160px; }

    .inside-item {
      min-width: 86px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      border-radius: 10px;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
    }
    .inside-item .mini-btn {
      width: 100%;
      height: 44px;
      border-radius: 8px;
      border: none;
      background: transparent;
      color: var(--accent);
      font-weight: 700;
      font-size: 15px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .inside-item .mini-btn:active { transform: translateY(1px); }
    @media (orientation: landscape) { .inside-item { min-width: 110px; padding: 10px; } }

    .landscape-btn {
      margin-left: 8px;
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 18px;
      cursor: pointer;
    }
    .landscape-btn:hover { color: var(--accent); }

    .menu-dots {
      margin-left: 6px;
      border: none;
      background: transparent;
      color: var(--muted);
      font-size: 18px;
      cursor: pointer;
      display: none;
      padding: 6px;
      border-radius: 8px;
    }
    .video-card.landscape-mode .menu-dots,
    @media (orientation: landscape) { .menu-dots { display: inline-block; } }
    .menu-dots:hover { color: var(--accent); background: rgba(255,255,255,0.02); }

    .swipe-indicator {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      min-width: 140px;
      padding: 10px 14px;
      border-radius: 10px;
      background: rgba(0,0,0,0.75);
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
      z-index: 20;
      pointer-events: none;
      opacity: 0;
      transition: opacity .12s ease;
      font-weight: 700;
      font-size: 15px;
    }
    .swipe-indicator.show { opacity: 1; }
    .swipe-icon { width: 22px; height: 22px; flex: 0 0 22px; }
    .swipe-value { min-width: 48px; text-align: right; font-variant-numeric: tabular-nums; }

    .error {
      position: absolute;
      left: 12px;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.6);
      padding: 16px;
      border-radius: 10px;
      color: #ff9b9b;
      display: none;
      text-align: center;
      z-index: 20;
    }

    .menu-overlay, .lang-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      pointer-events: auto;
      opacity: 0;
      visibility: hidden;
      transition: opacity .14s ease, visibility .14s;
    }
    .menu-overlay.show, .lang-overlay.show { opacity: 1; visibility: visible; }
    .menu-backdrop, .lang-backdrop {
      position: absolute;
      inset: 0;
      z-index: 99990;
      background: rgba(0,0,0,0.5);
    }
    .menu-sheet, .lang-sheet {
      position: relative;
      z-index: 99999;
      min-width: 280px;
      max-width: 92%;
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.04);
      padding: 16px;
      color: var(--accent);
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }
    .menu-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    .back-btn, .close-btn {
      background: transparent;
      border: none;
      color: var(--muted);
      font-size: 16px;
      cursor: pointer;
      padding: 6px;
      border-radius: 8px;
    }
    .back-btn { display: flex; align-items: center; gap: 8px; font-size: 16px; }
    .close-btn { margin-left: auto; font-size: 18px; }
    .back-btn:hover, .close-btn:hover {
      color: var(--accent);
      background: rgba(255,255,255,0.02);
    }
    .menu-list, .lang-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .menu-item, .lang-item {
      padding: 12px;
      border-radius: 10px;
      background: rgba(255,255,255,0.01);
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.02);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .menu-item:hover, .lang-item:hover { background: rgba(255,255,255,0.03); }
    .bold { font-weight: 800; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">Adam_D'H7</div>
    <div class="search-container">
      <input id="searchBox" class="search-box" placeholder="Rechèch..." oninput="filterSearch(this.value)">
    </div>
  </div>
  <div id="explorerView" role="main" aria-live="polite"></div>

  <script>
    const AD_REDIRECT_URL = "https://www.effectivegatecpm.com/sb8frb30?key=b74cd3abdfc6db3be0c0b8d215fcb582";

    function logAdEvent(action, extra = {}) {
      try {
        const logs = JSON.parse(localStorage.getItem('adLogs') || '[]');
        logs.push({ action, extra, t: new Date().toISOString() });
        while (logs.length > 1000) logs.shift();
        localStorage.setItem('adLogs', JSON.stringify(logs));
      } catch (e) {}
    }

    function tryOpenAdInBrowser(url) {
      try {
        const win = window.open(url, '_blank');
        if (win) {
          win.focus();
          logAdEvent('tab_opened', { url });
          return true;
        }
        return false;
      } catch (e) { return false; }
    }

    let allData = [];

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    fetch("index.json")
      .then(r => r.json())
      .then(files => Promise.all(files.map(f => fetch(f).then(r => r.json()))))
      .then(jsons => {
        jsons.forEach(d => Array.isArray(d) ? allData.push(...d) : allData.push(d));
        shuffle(allData);
        displayExplorer(allData);
      })
      .catch(err => {
        console.error("Erreur chargement JSON:", err);
        document.getElementById("explorerView").innerHTML = '<div style="color:#999;padding:20px;text-align:center">Pa kapab chaje kontni (index.json). Tcheke konsòl la pou plis detay.</div>';
      });

    function filterSearch(val) {
      const txt = (val || "").toLowerCase();
      const filtered = allData.filter(p =>
        (p.Catégorie || p.Categorie || p.category || "").toString().toLowerCase() === "poste" &&
        (
          (p.Texte || p.Bio || p.Info || "").toString().toLowerCase().includes(txt) ||
          (p.Name || "").toString().toLowerCase().includes(txt) ||
          (p.Description || p.Desc || "").toString().toLowerCase().includes(txt)
        )
      );
      displayExplorer(filtered);
    }

    function displayExplorer(data) {
      const ex = document.getElementById("explorerView");
      ex.innerHTML = "";
      data.forEach(post => {
        if ((post.Catégorie || post.Categorie || "").toString().toLowerCase() !== "poste") return;

        const card = document.createElement("div");
        card.className = "post-card";

        if (post.Texte || post.Bio || post.Info) {
          const text = document.createElement("div");
          text.className = "post-text";
          text.textContent = post.Texte || post.Bio || post.Info;
          card.appendChild(text);
        }

        const title = document.createElement("div");
        title.className = "post-name";
        title.textContent = post.Name || "";
        card.appendChild(title);

        const mediaWrap = document.createElement("div");
        mediaWrap.className = "media-wrap";

        const thumbCon = document.createElement("div");
        thumbCon.className = "post-thumb-container";

        const thumbSrc = post["Url Thumb"] || post.Previously || post.image || post.thumb || "";
        const img = document.createElement("img");
        img.className = "post-thumb";
        img.alt = post.Description || post.Name || "";
        img.loading = "lazy";
        img.src = thumbSrc || "https://via.placeholder.com/800x450?text=Preview";
        thumbCon.appendChild(img);

        mediaWrap.appendChild(thumbCon);
        card.appendChild(mediaWrap);

        if (post.Description || post.Desc || post.Texte) {
          const desc = document.createElement("div");
          desc.className = "post-desc";
          desc.textContent = post.Description || post.Desc || post.Texte;
          card.appendChild(desc);
        }

        thumbCon.addEventListener("click", ev => {
          ev.stopPropagation();
          const src = post.Previously || post.video || post["Url Video"] || post["Url"] || post.image || post.media || "";
          if (!thumbCon.querySelector('.video-card')) tryOpenAdInBrowser(AD_REDIRECT_URL);
          playMedia(src, thumbCon);
        });

        ex.appendChild(card);
      });
      displaySocialLinks();
    }

    function looksLikeVideo(src) {
      if (!src) return false;
      const url = src.toString().split('?')[0].toLowerCase();
      return /\.(mp4|webm|ogg|mov|mkv)$/.test(url) || src.includes("youtube.com") || src.includes("youtu.be") || src.includes("vimeo.com");
    }

    function normalizeYouTubeEmbed(src) {
      try {
        if (src.includes("youtu.be/")) {
          const id = src.split("youtu.be/")[1].split(/[?&]/)[0];
          return "https://www.youtube.com/embed/" + id + "?autoplay=1&rel=0";
        }
        const u = new URL(src);
        const v = u.searchParams.get('v');
        if (v) return "https://www.youtube.com/embed/" + v + "?autoplay=1&rel=0";
      } catch (e) {}
      return src;
    }

    function normalizeVimeoEmbed(src) {
      try {
        const parts = src.split('/');
        const id = parts.pop() || parts.pop();
        return "https://player.vimeo.com/video/" + id + "?autoplay=1";
      } catch (e) {}
      return src;
    }

    function adjustIFrameSize(iframe, container) {
      const cw = container.clientWidth;
      const h = Math.round(cw * 9 / 16);
      iframe.style.width = cw + "px";
      iframe.style.height = h + "px";
    }

    function playMedia(src, container) {
      if (!src) return;
      container.innerHTML = "";

      if (looksLikeVideo(src)) {
        if (src.includes("youtube.com") || src.includes("youtu.be")) {
          const iframe = document.createElement("iframe");
          iframe.src = normalizeYouTubeEmbed(src);
          iframe.allow = "autoplay; fullscreen; picture-in-picture";
          iframe.style.border = "none";
          container.appendChild(iframe);
          setTimeout(() => adjustIFrameSize(iframe, container), 60);
        } else if (src.includes("vimeo.com")) {
          const iframe = document.createElement("iframe");
          iframe.src = normalizeVimeoEmbed(src);
          iframe.allow = "autoplay; fullscreen; picture-in-picture";
          iframe.style.border = "none";
          container.appendChild(iframe);
          setTimeout(() => adjustIFrameSize(iframe, container), 60);
        } else {
          container.innerHTML = `
            <div class="video-card">
              <video preload="auto" playsinline crossorigin="anonymous">
                <source src="${src}" type="video/mp4">
                Votre navigateur ne supporte pas la vidéo HTML5.
              </video>
              <div class="inside-mini-controls inside-visible">
                <div class="inside-item"><button class="mini-btn">-10</button></div>
                <div class="inside-item"><button class="mini-btn">▶︎</button></div>
                <div class="inside-item"><button class="mini-btn">+10</button></div>
              </div>
              <div class="controls-wrap controls-visible">
                <div class="time-row">
                  <div class="time">0:00</div>
                  <div class="progress">
                    <div class="seek" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                      <div class="fill"></div>
                      <div class="thumb" aria-hidden="true"></div>
                    </div>
                  </div>
                  <div class="time">0:00</div>
                  <button class="landscape-btn" title="Basculer paysage">⛶</button>
                  <button class="menu-dots" title="Menu">⋯</button>
                </div>
              </div>
              <div class="swipe-indicator" aria-hidden="true">
                <div class="swipe-icon"></div>
                <div class="swipe-value">0%</div>
              </div>
              <div class="error">Impossible de lire la vidéo.<span></span></div>
              <div class="menu-overlay" aria-hidden="true" role="dialog" aria-modal="true">
                <div class="menu-backdrop"></div>
                <div class="menu-sheet">
                  <div class="menu-header">
                    <button class="back-btn" style="display:none">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>Retour
                    </button>
                    <strong>Options</strong>
                    <button class="close-btn">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                  </div>
                  <div class="menu-list">
                    <div class="menu-item" role="button" tabindex="0"><span>Langue</span><span>›</span></div>
                    <div class="menu-item" role="button" tabindex="0"><span>Mode PIP</span><span style="opacity:.8;font-size:13px">Activer</span></div>
                  </div>
                </div>
              </div>
              <div class="lang-overlay" aria-hidden="true" role="dialog" aria-modal="true">
                <div class="lang-backdrop"></div>
                <div class="lang-sheet">
                  <div class="menu-header">
                    <button class="back-btn">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>Retour
                    </button>
                    <strong>Langue</strong>
                    <button class="close-btn">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                  </div>
                  <div class="lang-list">
                    <div class="lang-item"><strong class="bold">Audio</strong><span style="opacity:.8">Français</span></div>
                    <div class="lang-item"><strong class="bold">Sous-titre</strong><span style="opacity:.8">Français</span></div>
                  </div>
                </div>
              </div>
            </div>`;
          initPlayer(container);
        }
      } else {
        const imgEl = document.createElement("img");
        imgEl.src = src;
        imgEl.loading = "lazy";
        imgEl.style.display = "block";
        imgEl.style.maxWidth = "100%";
        imgEl.style.objectFit = "contain";
        container.appendChild(imgEl);
      }
    }

    function initPlayer(container) {
      const card = container.querySelector('.video-card');
      const video = card.querySelector('video');
      if (!video) return;

      const insidePlay = card.querySelector('.inside-mini-controls .mini-btn:nth-child(2)');
      const insideForward = card.querySelector('.inside-mini-controls .mini-btn:nth-child(3)');
      const insideBack = card.querySelector('.inside-mini-controls .mini-btn:nth-child(1)');
      const seekBar = card.querySelector('.seek');
      const fill = card.querySelector('.fill');
      const thumb = card.querySelector('.thumb');
      const currentEl = card.querySelector('.time:nth-child(1)');
      const durationEl = card.querySelector('.time:nth-child(3)');
      const landscapeBtn = card.querySelector('.landscape-btn');
      const menuBtn = card.querySelector('.menu-dots');
      const controlsWrap = card.querySelector('.controls-wrap');
      const insideMini = card.querySelector('.inside-mini-controls');
      const swipeIndicator = card.querySelector('.swipe-indicator');
      const swipeIcon = card.querySelector('.swipe-icon');
      const swipeValue = card.querySelector('.swipe-value');
      const menuOverlay = card.querySelector('.menu-overlay');
      const menuBackdrop = card.querySelector('.menu-backdrop');
      const menuCloseBtn = card.querySelector('.menu-overlay .close-btn');
      const menuLang = card.querySelector('.menu-overlay .menu-item:first-child');
      const menuPip = card.querySelector('.menu-overlay .menu-item:last-child');
      const pipStatus = card.querySelector('.menu-overlay .menu-item:last-child span:last-child');
      const langOverlay = card.querySelector('.lang-overlay');
      const langBackdrop = card.querySelector('.lang-backdrop');
      const langCloseBtn = card.querySelector('.lang-overlay .close-btn');
      const langBackBtn = card.querySelector('.lang-overlay .back-btn');
      const errorBox = card.querySelector('.error');
      const errTxt = card.querySelector('.error span');

      const svgBrightness = `<svg viewBox="0 0 24 24" fill="none" width="22" height="22"><path d="M12 4V2M12 22v-2M4.93 4.93L3.51 3.51M20.49 20.49l-1.42-1.42M4 12H2M22 12h-2M4.93 19.07l-1.42 1.42M20.49 3.51l-1.42 1.42M12 8a4 4 0 100 8 4 4 0 000-8z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
      const svgVolume = `<svg viewBox="0 0 24 24" fill="none" width="22" height="22"><path d="M11 5L6 9H2v6h4l5 4V5z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M19 9a5 5 0 010 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;

      const cornerRatio = 0.20;

      function formatTime(sec) {
        sec = Math.floor(sec) || 0;
        const h = Math.floor(sec / 3600);
        const m = Math.floor((sec % 3600) / 60);
        const s = sec % 60;
        return h > 0 ? `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}` : `${m}:${String(s).padStart(2,'0')}`;
      }

      function isFullscreenCard() { return document.fullscreenElement === card || document.webkitFullscreenElement === card; }
      function isDeviceLandscape() { return window.innerWidth > window.innerHeight; }
      function allowOverlayNow() { return isFullscreenCard() || isDeviceLandscape(); }

      async function tryAutoplay() {
        try { await video.play(); } catch (e) { try { video.muted = true; await video.play(); } catch (_) {} }
        updatePlayIcon();
      }

      function updatePlayIcon() { insidePlay.textContent = video.paused ? '▶︎' : '❚❚'; }
      async function togglePlay() {
        try {
          if (video.paused) {
            video.muted = false;
            await video.play();
          } else video.pause();
        } catch (e) {}
        updatePlayIcon();
      }

      insidePlay.addEventListener('click', e => { e.stopPropagation(); togglePlay(); });
      insideForward.addEventListener('click', e => { e.stopPropagation(); video.currentTime = Math.min(video.duration || 0, video.currentTime + 10); });
      insideBack.addEventListener('click', e => { e.stopPropagation(); video.currentTime = Math.max(0, video.currentTime - 10); });

      let scrubbing = false;
      let wasPlaying = false;

      function timeFromX(x) {
        const rect = seekBar.getBoundingClientRect();
        let p = (x - rect.left) / rect.width;
        p = Math.max(0, Math.min(1, p));
        return (video.duration || 0) * p;
      }

      function startScrub(x) {
        wasPlaying = !video.paused;
        video.pause();
        scrubbing = true;
        const t = timeFromX(x);
        video.currentTime = t;
        currentEl.textContent = formatTime(t);
        fill.style.width = thumb.style.left = (t / (video.duration || 1) * 100) + '%';
      }

      function moveScrub(x) {
        if (!scrubbing) return;
        const t = timeFromX(x);
        video.currentTime = t;
        currentEl.textContent = formatTime(t);
        fill.style.width = thumb.style.left = (t / (video.duration || 1) * 100) + '%';
      }

      function endScrub() {
        if (!scrubbing) return;
        scrubbing = false;
        if (wasPlaying) video.play().catch(() => {});
      }

      seekBar.addEventListener('mousedown', e => { e.preventDefault(); e.stopPropagation(); startScrub(e.clientX); });
      seekBar.addEventListener('touchstart', e => { e.preventDefault(); e.stopPropagation(); startScrub(e.touches[0].clientX); }, { passive: false });
      window.addEventListener('mousemove', e => { if (scrubbing) moveScrub(e.clientX); });
      window.addEventListener('touchmove', e => { if (scrubbing && e.touches[0]) moveScrub(e.touches[0].clientX); }, { passive: false });
      window.addEventListener('mouseup', endScrub);
      window.addEventListener('touchend', endScrub);
      thumb.addEventListener('pointerdown', e => { e.preventDefault(); e.stopPropagation(); startScrub(e.clientX); });

      video.addEventListener('timeupdate', () => {
        const pct = (video.currentTime / (video.duration || 1)) * 100;
        currentEl.textContent = formatTime(video.currentTime);
        fill.style.width = thumb.style.left = pct + '%';
      });
      video.addEventListener('loadedmetadata', () => durationEl.textContent = formatTime(video.duration || 0));
      video.addEventListener('play', updatePlayIcon);
      video.addEventListener('pause', updatePlayIcon);

      function showAll() { controlsWrap.classList.replace('controls-hidden', 'controls-visible'); insideMini.classList.replace('inside-hidden', 'inside-visible'); }
      function hideAll() { controlsWrap.classList.replace('controls-visible', 'controls-hidden'); insideMini.classList.replace('inside-visible', 'inside-hidden'); }

      function isOverControls(t) {
        return t.closest('.controls-wrap,.inside-mini-controls,.inside-item,.seek');
      }

      card.addEventListener('click', e => { if (!isOverControls(e.target)) togglePlay(); });

      [insidePlay, insideForward, insideBack, seekBar, landscapeBtn, menuBtn].forEach(el => {
        if (el) {
          el.addEventListener('click', e => e.stopPropagation());
          el.addEventListener('pointerdown', e => e.stopPropagation());
          el.addEventListener('touchstart', e => e.stopPropagation(), { passive: false });
        }
      });

      async function enterLandscape() {
        try {
          const el = card;
          if (el.requestFullscreen) await el.requestFullscreen();
          else if (el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
          if (screen.orientation?.lock) await screen.orientation.lock('landscape');
        } catch (e) {}
        card.classList.add('landscape-mode');
        video.classList.add('contain');
        showAll();
      }

      async function exitLandscape() {
        try {
          if (screen.orientation?.unlock) screen.orientation.unlock();
          if (document.exitFullscreen) await document.exitFullscreen();
          else if (document.webkitExitFullscreen) await document.webkitExitFullscreen();
        } catch (e) {}
        card.classList.remove('landscape-mode');
        video.classList.remove('contain');
        showAll();
      }

      landscapeBtn.addEventListener('click', e => {
        e.stopPropagation();
        isFullscreenCard() ? exitLandscape() : enterLandscape();
      });

      document.addEventListener('fullscreenchange', () => {
        if (document.fullscreenElement === card) {
          card.classList.add('landscape-mode');
          video.classList.add('contain');
          showAll();
        } else {
          card.classList.remove('landscape-mode');
          video.classList.remove('contain');
          showAll();
        }
      });

      let gesture = null;
      let timeout = null;

      function showIndicator(kind, pct) {
        swipeIcon.innerHTML = kind === 'brightness' ? svgBrightness : svgVolume;
        swipeValue.textContent = pct + '%';
        swipeIndicator.classList.add('show');
        clearTimeout(timeout);
        timeout = setTimeout(() => swipeIndicator.classList.remove('show'), 800);
      }

      function startGesture(x, y) {
        if (!card.classList.contains('landscape-mode')) return;
        const rect = card.getBoundingClientRect();
        const relX = x - rect.left;
        const limit = rect.width * cornerRatio;
        if (relX <= limit) {
          const cur = parseFloat(getComputedStyle(video).filter.match(/brightness\(([0-9.]+)\)/)?.[1] || 1);
          gesture = { type: 'brightness', startY: y, value: cur };
          showIndicator('brightness', Math.round(cur * 100));
        } else if (relX >= rect.width - limit) {
          gesture = { type: 'volume', startY: y, value: video.volume };
          showIndicator('volume', Math.round(video.volume * 100));
        }
      }

      function moveGesture(y) {
        if (!gesture) return;
        const rect = card.getBoundingClientRect();
        const delta = (gesture.startY - y) / rect.height;
        let val = gesture.value + delta;
        val = Math.max(0, Math.min(1, val));
        if (gesture.type === 'brightness') {
          const applied = Math.max(0.05, val);
          video.style.filter = `brightness(${applied})`;
          showIndicator('brightness', Math.round(applied * 100));
        } else {
          video.volume = val;
          showIndicator('volume', Math.round(val * 100));
        }
      }

      function endGesture() {
        gesture = null;
        clearTimeout(timeout);
        timeout = setTimeout(() => swipeIndicator.classList.remove('show'), 600);
      }

      card.addEventListener('touchstart', e => { if (card.classList.contains('landscape-mode')) startGesture(e.touches[0].clientX, e.touches[0].clientY); }, { passive: false });
      card.addEventListener('touchmove', e => { if (card.classList.contains('landscape-mode')) moveGesture(e.touches[0].clientY); }, { passive: false });
      card.addEventListener('touchend', endGesture);

      video.addEventListener('error', () => {
        errorBox.style.display = 'block';
        errTxt.textContent = 'Videyo pa ka jwe.';
      });

      let menuOpenBeforeLang = false;

      function placeOverlayInCard(overlay) {
        if (overlay.parentNode !== card) card.appendChild(overlay);
        overlay.style.position = 'absolute';
        overlay.style.inset = '0';
      }

      function placeOverlayInBody(overlay) {
        if (overlay.parentNode !== document.body) document.body.appendChild(overlay);
        overlay.style.position = 'fixed';
        overlay.style.inset = '0';
      }

      function openMenu() {
        if (!allowOverlayNow()) return;
        placeOverlayInCard(menuOverlay);
        menuOverlay.classList.add('show');
        menuOverlay.setAttribute('aria-hidden', 'false');
        langOverlay.classList.remove('show');
        hideAll();
      }

      function closeMenu() {
        menuOverlay.classList.remove('show');
        menuOverlay.setAttribute('aria-hidden', 'true');
        showAll();
        if (!allowOverlayNow()) placeOverlayInBody(menuOverlay);
      }

      function openLang() {
        if (!allowOverlayNow()) return;
        menuOpenBeforeLang = menuOverlay.classList.contains('show');
        placeOverlayInCard(langOverlay);
        menuOverlay.classList.remove('show');
        langOverlay.classList.add('show');
        langOverlay.setAttribute('aria-hidden', 'false');
        hideAll();
      }

      function closeLang() {
        langOverlay.classList.remove('show');
        langOverlay.setAttribute('aria-hidden', 'true');
        if (menuOpenBeforeLang) {
          menuOverlay.classList.add('show');
          menuOverlay.setAttribute('aria-hidden', 'false');
          menuOpenBeforeLang = false;
        } else showAll();
        if (!allowOverlayNow()) placeOverlayInBody(langOverlay);
      }

      menuBtn.addEventListener('click', e => { e.stopPropagation(); openMenu(); });
      menuCloseBtn.addEventListener('click', e => { e.stopPropagation(); closeMenu(); });
      menuBackdrop.addEventListener('click', closeMenu);
      langCloseBtn.addEventListener('click', e => { e.stopPropagation(); closeLang(); });
      langBackdrop.addEventListener('click', closeLang);
      menuLang.addEventListener('click', e => { e.stopPropagation(); openLang(); });
      langBackBtn.addEventListener('click', e => { e.stopPropagation(); closeLang(); });

      menuPip.addEventListener('click', async e => {
        e.stopPropagation();
        try {
          if (document.pictureInPictureElement) {
            await document.exitPictureInPicture();
            pipStatus.textContent = 'Activer';
          } else {
            await video.play();
            if (video.requestPictureInPicture) await video.requestPictureInPicture();
            else if (video.webkitSetPresentationMode) video.webkitSetPresentationMode('picture-in-picture');
            pipStatus.textContent = 'Désactiver';
          }
        } catch (err) {
          pipStatus.textContent = 'Erreur';
          setTimeout(() => pipStatus.textContent = 'Activer', 1400);
        }
      });

      window.addEventListener('keydown', e => {
        if (e.key === 'Escape') {
          if (langOverlay.classList.contains('show')) closeLang();
          else if (menuOverlay.classList.contains('show')) closeMenu();
        }
      });

      window.addEventListener('orientationchange', () => { if (!allowOverlayNow()) { closeMenu(); closeLang(); } });
      window.addEventListener('resize', () => { if (!allowOverlayNow()) { closeMenu(); closeLang(); } });

      tryAutoplay();
      showAll();
    }

    function displaySocialLinks() {
      const container = document.getElementById("explorerView");
      if (document.querySelector('.social-section')) return;
      const section = document.createElement("div");
      section.className = "social-section";
      section.innerHTML = `
        <a href="https://www.facebook.com/profile.php?id=61578852256333" target="_blank" rel="noopener" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
        <a href="mailto:dhaitiadam@gmail.com" rel="noopener" aria-label="Email"><i class="fas fa-envelope"></i></a>
        <a href="https://whatsapp.com/channel/0029Vb6WLps7oQhWrUlyPQ2m" target="_blank" rel="noopener" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
        <a href="https://www.instagram.com/adam_dhaiti/" target="_blank" rel="noopener" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://youtube.com/@adam_dhaiti" target="_blank" rel="noopener" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
      `;
      container.appendChild(section);
    }
  </script>
</body>
</html>
